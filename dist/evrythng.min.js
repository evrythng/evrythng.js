// EVRYTHNG JS SDK v3.2.0
// (c) 2012-2015 EVRYTHNG Ltd. London / New York / San Francisco.
// Released under the Apache Software License, Version 2.0.
// For all details and usage:
// https://github.com/evrythng/evrythng.js


!function(a,b){"function"==typeof define&&define.amd?define(b(XMLHttpRequest,null)):a.EVT=a.Evrythng=b(XMLHttpRequest,null)}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,e=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("almond",function(){}),function(a,b,c){b[a]=b[a]||c(),"function"==typeof e&&e.amd?e("promise",[],function(){return b[a]}):"undefined"!=typeof module&&module.exports&&(module.exports=b[a])}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function a(a,b){m.add(a,b),l||(l=o(m.drain))}function b(a){var b,c=typeof a;return null==a||"object"!=c&&"function"!=c||(b=a.then),"function"==typeof b?b:!1}function c(){for(var a=0;a<this.chain.length;a++)d(this,1===this.state?this.chain[a].success:this.chain[a].failure,this.chain[a]);this.chain.length=0}function d(a,c,d){var e,f;try{c===!1?d.reject(a.msg):(e=c===!0?a.msg:c.call(void 0,a.msg),e===d.promise?d.reject(TypeError("Promise-chain cycle")):(f=b(e))?f.call(e,d.resolve,d.reject):d.resolve(e))}catch(g){d.reject(g)}}function e(d){var g,i,j=this;if(!j.triggered){j.triggered=!0,j.def&&(j=j.def);try{(g=b(d))?(i=new h(j),g.call(d,function(){e.apply(i,arguments)},function(){f.apply(i,arguments)})):(j.msg=d,j.state=1,j.chain.length>0&&a(c,j))}catch(k){f.call(i||new h(j),k)}}}function f(b){var d=this;d.triggered||(d.triggered=!0,d.def&&(d=d.def),d.msg=b,d.state=2,d.chain.length>0&&a(c,d))}function g(a,b,c,d){for(var e=0;e<b.length;e++)!function(e){a.resolve(b[e]).then(function(a){c(e,a)},d)}(e)}function h(a){this.def=a,this.triggered=!1}function i(a){this.promise=a,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function j(b){if("function"!=typeof b)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var d=new i(this);this.then=function(b,e){var f={success:"function"==typeof b?b:!0,failure:"function"==typeof e?e:!1};return f.promise=new this.constructor(function(a,b){if("function"!=typeof a||"function"!=typeof b)throw TypeError("Not a function");f.resolve=a,f.reject=b}),d.chain.push(f),0!==d.state&&a(c,d),f.promise},this["catch"]=function(a){return this.then(void 0,a)};try{b.call(void 0,function(a){e.call(d,a)},function(a){f.call(d,a)})}catch(g){f.call(d,g)}}var k,l,m,n=Object.prototype.toString,o="undefined"!=typeof setImmediate?function(a){return setImmediate(a)}:setTimeout;try{Object.defineProperty({},"x",{}),k=function(a,b,c,d){return Object.defineProperty(a,b,{value:c,writable:!0,configurable:d!==!1})}}catch(p){k=function(a,b,c){return a[b]=c,a}}m=function(){function a(a,b){this.fn=a,this.self=b,this.next=void 0}var b,c,d;return{add:function(e,f){d=new a(e,f),c?c.next=d:b=d,c=d,d=void 0},drain:function(){var a=b;for(b=c=l=void 0;a;)a.fn.call(a.self),a=a.next}}}();var q=k({},"constructor",j,!1);return j.prototype=q,k(q,"__NPO__",0,!1),k(j,"resolve",function(a){var b=this;return a&&"object"==typeof a&&1===a.__NPO__?a:new b(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");b(a)})}),k(j,"reject",function(a){return new this(function(b,c){if("function"!=typeof b||"function"!=typeof c)throw TypeError("Not a function");c(a)})}),k(j,"all",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):0===a.length?b.resolve([]):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");var e=a.length,f=Array(e),h=0;g(b,a,function(a,b){f[a]=b,++h===e&&c(f)},d)})}),k(j,"race",function(a){var b=this;return"[object Array]"!=n.call(a)?b.reject(TypeError("Not an array")):new b(function(c,d){if("function"!=typeof c||"function"!=typeof d)throw TypeError("Not a function");g(b,a,function(a,b){c(b)},d)})}),j}),e("utils",["promise"],function(a){"use strict";return{isFunction:function(a){return"[object Function]"==Object.prototype.toString.call(a)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isObject:function(a){return a===Object(a)&&!this.isArray(a)},extend:function(a,b,c){var d;if(c)d=a;else{d={};for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e])}for(var f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);return d},buildParams:function(a){if(this.isObject(a)){var b=[];for(var c in a)if(a.hasOwnProperty(c)&&void 0!==a[c]){var d=this.isObject(a[c])?this.buildParams(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}return a},buildUrl:function(a){var b=a.apiUrl+(a.url?a.url:"");return a.params&&(b+=(-1===b.indexOf("?")?"?":"&")+this.buildParams(a.params)),b},getCurrentPosition:function(b){if("undefined"!=typeof window&&window.navigator.geolocation){var c=this.extend({maximumAge:0,timeout:1e4,enableHighAccuracy:!0},b);return new a(function(a,b){window.navigator.geolocation.getCurrentPosition(function(b){a(b)},function(a){var c="Geolocation: ";c=1===a.code?"You didn't share your location.":2===a.code?"Couldn't detect your current location.":3===a.code?"Retrieving position timed out.":"Unknown error.",b(c)},c)})}return new a(function(a,b){b("Your browser/environment doesn't support geolocation.")})}}}),e("core",["utils"],function(a){"use strict";var b="3.2.0",c={apiUrl:"https://api.evrythng.com",fullResponse:!1,quiet:!1,geolocation:!0,interceptors:[]},e={version:b,settings:c,Entity:{},setup:function(b){if(!a.isObject(b))throw new TypeError("Setup should be called with an options object.");return this.settings=a.extend(this.settings,b),this.settings},use:function(b,c){if(a.isObject(b)&&a.isFunction(b.install)){var e=[];return b.$inject&&b.$inject.forEach(function(a){e.push(d(a))}),b.install.apply(b,e),this}throw new TypeError("Plugin must implement 'install()' method.")}};return e}),e("scope/scope",["utils"],function(a){"use strict";var b=function(b){if(this.parentScope=null,!a.isString(b))throw new TypeError("Scope constructor should be called with API Key.");this.apiKey=b};return b}),e("logger",["core"],function(a){"use strict";var b="EvrythngJS";return{error:function(c){a.settings.quiet===!1&&console.error(b+" Error:",c)},info:function(c){a.settings.quiet===!1&&console.info(b+" Info:",c)}}}),e("network/cors",["core","promise","utils","logger"],function(b,c,d,e){"use strict";function f(a,b){var c=function(a){var b={};if(a){a=a.trim().split("\n");for(var c in a){var d=a[c].toLowerCase().match(/([^:]+):(.*)/);b[d[1].trim()]=d[2].trim()}}return b},d=c(a.getAllResponseHeaders()),e=null;if(a.responseText){var f=d["content-type"];if(f&&-1!==f.indexOf("application/json"))try{e=JSON.parse(a.responseText)}catch(g){e=a.responseText}else e=a.responseText}return b&&(e={data:e,headers:d,status:a.status},e.data&&e.data.errors&&(e.errors=e.data.errors,delete e.data.errors)),e}function g(a,b,c,d){var e={status:a.status,type:"cors",message:"Server responded with an error for the CORS request",url:b,method:c};return d&&(e.errors=d.errors,e.moreInfo=d.moreInfo),e}function h(b,c,d){var e=new a;return e.open(b,c),e.setRequestHeader("content-type","application/json"),e.setRequestHeader("accept",d.accepts?d.accepts:"*/*"),d.authorization&&e.setRequestHeader("authorization",d.authorization),d.timeout>0&&(e.timeout=d.timeout),e}function i(a,b,i){a=a||{};var j=a.method||"get",k=d.buildUrl(a),l=h(j,k,a),m=a.data?JSON.stringify(a.data):null;return new c(function(c,d){function h(){try{if(this.readyState===this.DONE){var d=f(this,a.fullResponse);this.status>=200&&this.status<300?(b&&b(d),c(d)):n(d)}}catch(e){}}l.onerror=function(){var a=new Error("Network error.");a.name="CorsError",d(a)};var n=function(a){if(a){var b=g(l,k,j,a);e.error(b),i&&i(b),d(b)}};a.timeout>0&&(l.ontimeout=function(){var a={errors:["Request timed out."]};n(a)}),l.onreadystatechange=h,l.send(m)})}return i}),e("network/jsonp",["core","promise","utils","logger"],function(a,b,c,d){"use strict";function e(a,b,c,d){var e={status:b,type:"jsonp",message:"Server responded with an error for the JSONP request",url:a,method:c};return d&&(e.errors=d.errors,e.moreInfo=d.moreInfo),e}function f(a){var b=document.createElement("script"),c=!1;b.src=a,b.onload=b.onreadystatechange=function(){c||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(c=!0,b.onload=b.onreadystatechange=null,b&&b.parentNode&&b.parentNode.removeChild(b))},h||(h=document.getElementsByTagName("head")[0]),h.appendChild(b)}function g(a,g,h){a=a||{};var j="callback_json"+ ++i,k=a.params||{};k.callback=j,k.access_token=a.authorization,k.method=a.method||"get",k.data=JSON.stringify(a.data),a.params=k,a.apiUrl=a.apiUrl&&a.apiUrl.replace("//api","//js-api");var l=c.buildUrl(a);return new b(function(a,b){window[j]=function(c){if(c.errors&&c.status){var f=e(l,c.status,k.method,c);d.error(f),h&&h(f),b(f)}else{g&&g(c);try{c=JSON.parse(c)}catch(i){}a(c)}try{delete window[j]}catch(i){}window[j]=null},f(l,b)})}var h,i=0;return g}),e("connect",["core","network/cors","network/jsonp","promise","utils","logger"],function(b,c,d,e,f,g){"use strict";function h(h,i,j){function k(){o=!0}var l,m,n=f.extend({apiUrl:b.settings.apiUrl,url:"/",fullResponse:b.settings.fullResponse,authorization:b.settings.apiKey||b.settings.authorization,timeout:b.settings.timeout,interceptors:b.settings.interceptors},h),o=!1;if(f.isFunction(i)?l=i:h&&f.isFunction(h.success)&&(l=h.success),f.isFunction(j)?m=j:h&&f.isFunction(h.error)&&(m=h.error),f.isArray(n.interceptors)&&n.interceptors.forEach(function(a){if(a.request&&f.isFunction(a.request)&&!o){var b=a.request(n,k);n=b||n}}),o)return e.reject({errors:["Request cancelled on request interceptors."],cancelled:!0});if(a){var p,q="boolean"==typeof(new a).withCredentials;return q?p=c(n,l,m):(g.info("CORS not supported, falling back to JSONP."),p=d(n,l,m)),f.isArray(n.interceptors)&&n.interceptors.forEach(function(a){a.response&&f.isFunction(a.response)&&(p=p.then(a.response))}),p}throw new Error("XMLHttpRequest not available.")}return b.api=h,b}),e("resource",["core","promise","scope/scope","utils","logger","connect"],function(a,b,c,d,e){"use strict";function f(b,c,e,f){var h,i=e,j=f;return d.isFunction(c)||null===c?(i=c,j=e):d.isObject(c)&&(b=d.extend(b,c)),b.authorization=this.scope.apiKey,a.Operator&&this.scope.parentScope instanceof a.Operator&&(b.authorization=this.scope.parentScope.apiKey,this.scope instanceof a.App&&(b.params=b.params||{},b.params.project=this.scope.project)),h=a.api(b,i,j),g.call(this,h)}function g(a){var b=this;return a.then(function(a){return b.parse(a)})}var h=function(a,b,f){if(!(a&&a instanceof c))throw new TypeError("Scope should inherit from Scope (e.g. EVT.App).");if(this.scope=a,!d.isString(b))throw new TypeError("Resource must have a String path.");"/"!=b[0]&&(b="/"+b),this.path=b,d.isFunction(f)?d.isFunction(f.prototype.toJSON)?this["class"]=f:e.error('Class for resource "'+b+'" does not implement toJSON().'):e.info('Class for resource "'+b+'" undefined. It will not return proper Entities nor cascaded Entities.')};return h.prototype.parse=function(a){var b=null;if(this["class"]&&a){var c=this;if(d.isArray(a)){b=[];var e=c.path;a.forEach(function(a){if(d.isObject(a)){var f=a.id;f&&(c=new h(c.scope,e+"/"+f,c["class"])),b.push(new c["class"](a,c))}else b.push(a)})}else d.isObject(a)?a.hasOwnProperty("data")?(b=a,b.data=c.parse(b.data),d.isObject(b.headers)&&d.isString(b.headers["x-result-count"])&&(b.count=parseInt(b.headers["x-result-count"]))):b=new this["class"](a,this):b=a}else b=a;return b},h.prototype.jsonify=function(a){return this["class"]&&a instanceof this["class"]?a.toJSON():a||{}},h.prototype.create=function(a,b,c,e){if(!a||d.isFunction(a))throw new TypeError("Create method should have payload.");var g={url:this.path,method:"post",data:this.jsonify(a)};return f.call(this,g,b,c,e)},h.prototype.read=function(a,b,c){var d={url:this.path};return f.call(this,d,a,b,c)},h.prototype.count=function(a,c,d){var e={url:this.path,fullResponse:!0,params:{perPage:1,page:1}};return f.call(this,e,a,c,d).then(function(a){return new b(function(b,c){void 0!==a.count?b(a.count):c(new TypeError("Resource must be a collection."))})})},h.prototype.update=function(a,b,c,d){var e={url:this.path,method:"put",data:this.jsonify(a)};return f.call(this,e,b,c,d)},h.prototype["delete"]=function(a,b,c){var d={url:this.path,method:"delete"};return f.call(this,d,a,b,c)},h.constructorFactory=function(a,b,c){return function(e){var f=a||"";if(e){if(!d.isString(e))throw new TypeError("ID must be a string.");f+="/"+e}var g=new h(this,f,b);if(c){var i=new b({id:e},g);if(!d.isArray(c))throw new TypeError("Nested resources should be an array.");c.forEach(function(a){i[a]&&(g[a]=function(){return i[a].apply(i,arguments)})})}return g}},h}),e("entity/entity",["resource","utils"],function(a,b){"use strict";var c=function(c,d){b.isObject(c)&&(c instanceof a?this.resource=c:(this.resource=d,b.extend(this,c,!0)))};return c.prototype.toJSON=function(){var a={};for(var c in this)this.hasOwnProperty(c)&&this[c]&&!b.isFunction(this[c])&&"resource"!=c&&(a[c]=this[c]);return a},c.prototype.update=function(a){if(this.resource){var c=arguments,d=this;return(null===a||!a||b.isFunction(a))&&(c=Array.prototype.slice.call(arguments,0),c.unshift(this.toJSON())),this.resource.update.apply(this.resource,c).then(function(a){return b.extend(d,a,!0),a})}throw new Error("This entity has no resource")},c.prototype["delete"]=function(){if(this.resource)return this.resource["delete"].apply(this.resource,arguments);throw new Error("This entity has no resource")},c}),e("entity/property",["core","./entity","resource","utils"],function(a,b,c,d){"use strict";function e(a){var b=a[0];if(d.isString(b)||"number"==typeof b||"boolean"==typeof b)a[0]=[{value:b}];else if(d.isObject(b))if(b.value)a[0]=[b];else{a[0]=[];for(var c in b)a[0].push({key:c,value:b[c]})}return a}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,a.Entity.Property=f,{"class":f,resourceConstructor:function(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var f,g=this.resource.path+"/properties";if(b){if(!d.isString(b))throw new TypeError("Property must be a key/name string");g+="/"+b}return f=new c(this.resource.scope,g,a.Entity.Property),f.update=function(){return c.prototype.update.apply(this,e(arguments))},f}}}),e("entity/action",["core","./entity","scope/scope","resource","utils","logger"],function(a,b,c,d,e,f){"use strict";function g(a){var b=arguments;return(!a||e.isFunction(a))&&(b=Array.prototype.slice.call(arguments,0),b.unshift({})),b}function h(b,c){return b.constructor===a.Entity.Product?c.product=b.id:b.constructor===a.Entity.Thng?c.thng=b.id:b.constructor===a.Entity.Collection&&(c.collection=b.id),c}function i(a,b,d){if(!(a instanceof c||a.id))throw new Error("This entity does not have an ID.");var f=b;return e.isArray(b)?f=b.map(function(b){return i(a,b,d)}):(f.type="all"!==d&&d||b.type||"",h(a,f)),f}var j=function(){b.apply(this,arguments)};return j.prototype=Object.create(b.prototype),j.prototype.constructor=j,a.Entity.Action=j,{"class":j,resourceConstructor:function(b,h){var j,k,l=this,m=this instanceof c?this:this.resource.scope;if(!b)throw new TypeError("Action type cannot be empty.");if(!e.isString(b))throw new TypeError("Action type must be a name string");var n="/actions/"+b;return j=this instanceof c?n:this.resource.path+n,k=d.constructorFactory(j,a.Entity.Action).call(m,h),k.create=function(){var c=this,h=g.apply(this,arguments);return h[0]=i(l,h[0],b),a.settings.geolocation?e.getCurrentPosition().then(function(a){return h[0].location={latitude:a.coords.latitude,longitude:a.coords.longitude},h[0].locationSource="sensor",d.prototype.create.apply(c,h)},function(a){return f.info(a),d.prototype.create.apply(c,h)}):d.prototype.create.apply(c,h)},k}}}),e("entity/product",["core","./entity","resource","./property","./action","utils"],function(a,b,c,d,e,f){"use strict";var g=function(){b.apply(this,arguments)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,f.extend(g.prototype,{property:d.resourceConstructor,action:e.resourceConstructor},!0),a.Entity.Product=g,{"class":g,resourceConstructor:c.constructorFactory("/products",a.Entity.Product,["property","action"])}}),e("entity/user",["core","./entity","resource","utils"],function(a,b,c,d){"use strict";function e(b){if(!b||!d.isString(b))throw new Error("Activation code must be a string.");if(this.type&&"anonymous"===this.type)throw new Error("Anonymous users can't be validated.");var c=this.scope,e=this.path;return this.id&&(c=this.resource.scope,e=this.resource.path+"/"+this.id),a.api({url:e+"/validate",method:"post",authorization:c.apiKey,data:{activationCode:b}})}function f(){var b=this;return a.api({url:this.path,method:"post",params:{anonymous:!0},data:{},authorization:this.scope.apiKey}).then(function(c){return new a.User({id:c.evrythngUser,apiKey:c.evrythngApiKey,type:"anonymous"},b.scope)})}var g=function(a){var c=arguments;a.evrythngUser&&(a.id=a.evrythngUser,delete a.evrythngUser),c[0]=a,b.apply(this,c)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,d.extend(g.prototype,{validate:function(){return e.call(this,this.activationCode)}},!0),a.Entity.User=g,{"class":g,resourceConstructor:function(b){var g=b||"/users";return function(b){var h=c.constructorFactory(g,a.Entity.User).call(this,b);return h.validate=function(){return e.apply(this,arguments)},h.update=function(){if(this.scope.type&&"anonymous"===this.scope.type)throw new Error("Anonymous users are read-only.");return c.prototype.update.apply(this,arguments)},h.create=function(){var a=this,b=arguments[0];return d.isObject(b)&&b.anonymous===!0?f.call(a):c.prototype.create.call(a,b)},h}}}}),e("entity/place",["core","./entity","resource","scope/scope","utils","logger"],function(a,b,c,d,e,f){"use strict";function g(a){var b=a[0];return(!b||e.isFunction(b))&&(a=Array.prototype.slice.call(a,0),a.unshift({})),a}var h=function(){b.apply(this,arguments)};return h.prototype=Object.create(b.prototype),h.prototype.constructor=h,a.Entity.Place=h,{"class":h,resourceConstructor:function(b){var h=this instanceof d?this:this.resource.scope,i=c.constructorFactory("/places",a.Entity.Place).call(h,b);return i.read=function(){var b=this,d=g(arguments),h=d[0].params||{};return"undefined"==typeof h.lat&&"undefined"==typeof h.lon&&a.settings.geolocation?e.getCurrentPosition().then(function(a){return h.lat=a.coords.latitude,h.lon=a.coords.longitude,d[0].params=h,c.prototype.read.apply(b,d)},function(a){return f.info(a),c.prototype.read.apply(b,d)}):c.prototype.read.apply(b,d)},i}}}),e("social/facebook",["promise","utils"],function(a,b){"use strict";function c(b){return new a(function(a){window.fbAsyncInit=function(){FB.init({appId:b,version:"v2.0"}),FB.getLoginStatus(function(b){f(b).then(function(b){a(b)})})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")})}function d(b){return new a(function(a,c){FB.login(function(b){f(b).then(function(b){b.user?a(b):c(b)})},b)})}function e(){return new a(function(a){FB.logout(a)})}function f(c){return new a("connected"==c.status?function(a){FB.api("/me",function(d){a(b.extend(c,{user:d}))})}:function(a){a(c)})}return{init:c,login:d,logout:e}}),e("authentication",["core","promise","social/facebook","utils","connect"],function(a,b,c,d){"use strict";function e(a,b,c,e){var h=c,i=e;if(!a)throw new TypeError("Credentials (for Evrythng) or type (for Third party) are missing.");return d.isString(a)?"facebook"===a?f.call(this,b,h,i):"evrythng"===a?g.call(this,b,h,i):void 0:g.call(this,a,b,h)}function f(a,e,f){var g={scope:"email"},i=this;if(d.isFunction(a)||null===a){var j=e;e=a,f=j}else d.isObject(a)&&(g=a);return new b(function(a,b){c.login(g).then(function(b){h.call(i,b).then(function(b){e&&e(b),a(b)})},function(a){f&&f(a),b(a)})})}function g(a,b,c){if(!a||d.isFunction(a))throw new TypeError("Credentials are missing.");return i.call(this,a).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}function h(b){var c=this;return a.api({url:"/auth/facebook",method:"post",data:{access:{token:b.authResponse.accessToken}},authorization:this.apiKey}).then(function(e){var f=new a.User({id:e.evrythngUser,apiKey:e.evrythngApiKey},c);return d.extend(f,{facebook:b.user},!0),b.user=f,b})}function i(b){var c=this;return a.api({url:"/auth/evrythng",method:"post",data:b,authorization:this.apiKey}).then(function(b){return a.api({url:"/users/"+b.evrythngUser,authorization:b.evrythngApiKey}).then(function(e){var f=d.extend(e,{id:b.evrythngUser,apiKey:b.evrythngApiKey}),g=new a.User(f,c);return{user:g}})})}function j(a,b,c){return a&&d.isString(a)?"facebook"===a?k.call(this,b,c):"evrythng"===a?l.call(this,b,c):void 0:l.call(this,a,b)}function k(a,b){var d=this;return c.logout().then(function(){return l.call(d,a,b)})}function l(b,c){return a.api({url:"/auth/all/logout",method:"post",authorization:this.apiKey}).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}return{login:e,logout:j,authFacebook:h}}),e("scope/application",["core","./scope","entity/product","entity/action","entity/user","entity/place","authentication","social/facebook","utils","logger"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=function(c,d){var e=this;i.isObject(c)?(b.call(this,c.apiKey),i.extend(this,c,!0)):b.call(this,c),d instanceof b&&(this.parentScope=d),this.$init=a.api({url:"/applications/me",authorization:this.apiKey}).then(function(a){return delete a.appApiKey,i.extend(e,a,!0)},function(){j.error("There is no application with this API Key.")}).then(function(a){return c.facebook?a.socialNetworks&&a.socialNetworks.facebook?h.init(a.socialNetworks.facebook.appId).then(function(a){return"connected"===a.status?g.authFacebook.call(e,a):a}).then(function(b){return i.extend(b,{app:a})}):void j.error("The Facebook configuration for this application is incorrect."):a})};return k.prototype=Object.create(b.prototype),k.prototype.constructor=k,i.extend(k.prototype,{product:c.resourceConstructor,action:d.resourceConstructor,appUser:e.resourceConstructor("/auth/evrythng/users"),place:f.resourceConstructor,login:g.login},!0),a.App=k}),e("entity/location",["core","./entity","resource","utils","logger"],function(a,b,c,d,e){"use strict";function f(a){var b=a[0];return d.isObject(b)?a[0]=[b]:(!b||d.isFunction(b))&&(a=Array.prototype.slice.call(a,0),a.unshift([])),a}var g=function(){b.apply(this,arguments)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,a.Entity.Location=g,{"class":g,resourceConstructor:function(){var b=this.resource.path+"/location",g=arguments[0]||[];if(d.isString(g)||d.isObject(g)&&d.isString(g.id))throw new TypeError("IDs not allowed here");var h=new c(this.resource.scope,b,a.Entity.Location);return h.update=function(){var b=this,g=f(arguments);return 0===g[0].length&&a.settings.geolocation?d.getCurrentPosition().then(function(a){return g[0]=[{position:{type:"Point",coordinates:[a.coords.longitude,a.coords.latitude]}}],c.prototype.update.apply(b,g)},function(a){return e.info(a),c.prototype.update.apply(b,g)}):c.prototype.update.apply(b,g)},h}}}),e("entity/thng",["core","./entity","resource","./property","./action","./location","utils"],function(a,b,c,d,e,f,g){"use strict";function h(){if(!this.product)throw new Error("Thng does not have a product.");if(!this.resource)throw new Error("Thng does not have a resource.");return this.resource.scope.product(this.product).read()}var i=function(){b.apply(this,arguments)};return i.prototype=Object.create(b.prototype),i.prototype.constructor=i,g.extend(i.prototype,{property:d.resourceConstructor,action:e.resourceConstructor,location:f.resourceConstructor,readProduct:h},!0),a.Entity.Thng=i,{"class":i,resourceConstructor:c.constructorFactory("/thngs",a.Entity.Thng,["property","action","location"])}}),e("entity/actionType",["core","./entity","scope/scope","resource","utils"],function(a,b,c,d,e){"use strict";var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,a.Entity.ActionType=f,{"class":f,resourceConstructor:function(){var b=this instanceof c?this:this.resource.scope,f=arguments[0];if(e.isString(f)||e.isObject(f)&&e.isString(f.id))throw new TypeError("IDs not allowed here");return d.constructorFactory("/actions",a.Entity.ActionType).call(b)}}}),e("entity/collection",["core","./entity","resource","./action","utils"],function(a,b,c,d,e){"use strict";function f(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var d=this.resource.path+"/thngs";return c.constructorFactory(d,a.Entity.Thng).call(this.resource.scope,b)}var g=function(){b.apply(this,arguments)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,e.extend(g.prototype,{thng:f,action:d.resourceConstructor},!0),a.Entity.Collection=g,{"class":g,resourceConstructor:c.constructorFactory("/collections",a.Entity.Collection,["thng","action"])}}),e("entity/multimedia",["core","./entity","resource"],function(a,b,c){"use strict";var d=function(){b.apply(this,arguments)};return d.prototype=Object.create(b.prototype),d.prototype.constructor=d,a.Entity.Multimedia=d,{"class":d,resourceConstructor:c.constructorFactory("/contents/multimedia",a.Entity.Multimedia)}}),e("search",["core","utils"],function(a,b){"use strict";function c(c,d){var e={};return b.isString(c)?(e.q=c,e=b.extend(e,d)):(e=c,d&&b.extend(e,d,!0)),a.api({url:"/search",params:e,authorization:this.apiKey})}return c}),e("scope/user",["core","./scope","entity/product","entity/thng","entity/user","entity/actionType","entity/action","entity/collection","entity/multimedia","entity/place","authentication","utils","search"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var a=this,b=e.resourceConstructor().call(this,this.id);return b.update.apply(b,arguments).then(function(b){return l.extend(a,b,!0),b})}var o=function(a,c){l.isObject(a)?(b.call(this,a.apiKey),l.extend(this,a,!0)):b.call(this,a),c instanceof b&&(this.parentScope=c)};return o.prototype=Object.create(b.prototype),o.prototype.constructor=o,l.extend(o.prototype,{product:c.resourceConstructor,thng:d.resourceConstructor,actionType:f.resourceConstructor,action:g.resourceConstructor,collection:h.resourceConstructor,multimedia:i.resourceConstructor,place:j.resourceConstructor,logout:k.logout,search:m,update:n},!0),a.User=o}),e("scope/device",["core","./scope","entity/thng","utils"],function(a,b,c,d){"use strict";function e(){var a=this,b=c.resourceConstructor.call(this,this.id);return b.update.apply(b,arguments).then(function(b){return d.extend(a,b,!0),b})}function f(){var a=c.resourceConstructor.call(this,this.id);return a.property.apply(a,arguments)}function g(){var a=c.resourceConstructor.call(this,this.id);return a.action.apply(a,arguments)}var h=function(a,c){if(!d.isObject(a))throw new TypeError("DeviceScope constructor should be called with object containing API Key and ID of device.");b.call(this,a.apiKey),d.extend(this,a,!0),c instanceof b&&(this.parentScope=c)};return h.prototype=Object.create(b.prototype),h.prototype.constructor=h,d.extend(h.prototype,{property:f,action:g,update:e},!0),a.Device=h}),e("evrythng",["core","scope/application","scope/user","scope/device"],function(a){"use strict";return a}),d("evrythng")});
//# sourceMappingURL=evrythng.min.js.map